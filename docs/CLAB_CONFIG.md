# Containerlab 拓扑配置文档

本文档描述了 Containerlab 拓扑配置文件（`.clab.yaml`）的高层逻辑结构。该文件用于描述网络实验环境的物理拓扑（节点与链路）及其实运行时属性。

## 核心对象模型

配置文件的核心在于定义图（Graph）结构，其中：
- **节点 (Nodes)**：代表网络设备（路由器）。
- **链路 (Links)**：代表设备接口之间的物理连接。

---

## 节点定义 (Nodes)

节点部分的配置描述了每个路由器的运行时环境和初始状态。

路径：`topology.nodes`

| 抽象属性 | 对应 YAML 字段 | 描述 |
| :--- | :--- | :--- |
| **节点标识** | `keys of nodes` | 路由器的唯一标识符（如 `router_00_00`）。 |
| **运行时环境** | `image`, `kind` | 定义节点运行所需的软件环境（如 Docker 镜像）。 |
| **配置持久化** | `binds` | 定义配置文件的挂载关系。将生成的配置文件（FRR 配置）注入到节点中。 |
| **初始化动作** | `exec` | 节点启动后立即执行的特定操作列表。目前主要用于**链路属性注入**（如设置链路延迟、丢包率等）。 |

> **注意**：`exec` 列表中的命令是具体的实现细节（如 Linux `tc` 命令），在上层抽象中应被视为“节点接口的物理属性配置”。

---

## 链路定义 (Links)

链路定义描述了物理拓扑的连接矩阵。

路径：`topology.links`

每个链路对象本质上是一个无向边，连接两个节点的特定端口。

| 抽象属性 | 对应 YAML 字段 | 描述 |
| :--- | :--- | :--- |
| **连接端点** | `endpoints` | 定义连接的两端，格式为 `Node:Interface`。 |

### 拓扑解析逻辑

要还原完整的网络拓扑图，需执行以下步骤：

1.  **节点发现**：遍历 `topology.nodes` 获取所有图节点。
2.  **边构建**：遍历 `topology.links`，解析 `endpoints` 对，建立节点间的邻接关系。
3.  **属性关联**：
    -   **配置关联**：通过节点的 `binds` 路径关联到具体的业务配置文件（如 FRR `ospf6d.conf`）。
    -   **链路属性提取**：解析节点的 `exec` 列表，识别针对特定接口的属性设置（例如，识别针对 `eth1` 的延迟设置命令，将其关联到该节点在 `links` 中连接到 `eth1` 的那条边上）。
